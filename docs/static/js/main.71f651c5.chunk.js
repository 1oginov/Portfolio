(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{42:function(e,t,n){e.exports=n(75)},75:function(e,t,n){"use strict";n.r(t);var o,r,c=n(0),u=n(36),i=n.n(u),a=n(2),s=function(e){var t=e.instrument,n=e.value;return c.createElement("span",null,n.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),t&&t.symbol)},l=Object(a.b)(function(e,t){var n=e.diff,o=t.instrumentId;return{instrument:n&&n.instrument?n.instrument.find(function(e){return e.id===o}):void 0}})(s),d=function(e){var t=e.account;return c.createElement("div",null,c.createElement("div",null,t.title),c.createElement("div",null,c.createElement(l,{instrumentId:t.instrument,value:t.balance})))},f=function(e){var t=e.balance,n=e.instrumentId;return c.createElement(l,{instrumentId:n,value:t})},m=n(1),b=n(3),p=n(5),h=function(e,t){return e.map(function(e){var n=e.amount,o=e.symbol,r=Object(p.extractData)(Object(b.getResourceById)(t,o));return r&&r.iexRealtimePrice?n*r.iexRealtimePrice:0}).reduce(function(e,t){return e+t},0)},g=Object(m.b)(Object(a.b)(function(e){var t=e.brokerageAccountId,n=e.diff,o=e.portfolio,r=e.stockQuotes;return{brokerageAccountId:t,instruments:n&&n.instrument?n.instrument:[],portfolio:o,stockQuotes:r}}),Object(m.g)(function(e){var t=e.accounts,n=e.brokerageAccountId,o=e.instrumentId,r=e.instruments,c=e.portfolio,u=e.stockQuotes,i=r.find(function(e){return e.id===o});return{balance:t.map(function(e){var t=e.balance,a=e.instrument;if(e.id===n&&(t=h(c,u),a=1),a===o)return t;var s=r.find(function(e){return e.id===a});return t/i.rate*s.rate}).reduce(function(e,t){return e+t},0)}}))(f),v=function(e){var t=e.accounts,n=e.brokerageAccountId,o=e.setBrokerageAccount;return c.createElement("div",null,c.createElement("div",null,"Total: ",c.createElement(g,{accounts:t,instrumentId:2})),c.createElement("ul",null,t.map(function(e){return c.createElement("li",{key:e.id},e.id===n&&"*",c.createElement(d,{account:e}),c.createElement("button",{onClick:function(){return o(e.id!==n?e.id:"")}},e.id!==n?"Brokerage":"Not brokerage"))})))},k=n(23),O=n(15),E=n(16),y=n(10),j=n.n(y),S=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://api.iextrading.com/1.0";Object(O.a)(this,e),this.url=t}return Object(E.a)(e,[{key:"getStockLogo",value:function(e){return j.a.get("".concat(this.url,"/stock/").concat(e,"/logo")).then(function(e){return e.data.url})}},{key:"getStockQuote",value:function(e){return j.a.get("".concat(this.url,"/stock/").concat(e,"/quote")).then(function(e){return e.data})}}]),e}()),A=n(7),T=new(function(){function e(t,n,o){Object(O.a)(this,e),this.consumerKey=t,this.consumerSecret=n,this.redirectUrl=o}return Object(E.a)(e,[{key:"setToken",value:function(e){return this.token=e,this}},{key:"getAuthorizeUrl",value:function(){return"https://api.zenmoney.ru/oauth2/authorize?client_id=".concat(this.consumerKey,"&redirect_uri=").concat(this.redirectUrl,"&response_type=code")}},{key:"extractAuthorizeCode",value:function(e){var t=new URL(e);return new URLSearchParams(t.search).get("code")}},{key:"getTokens",value:function(e){var t=new URLSearchParams;return t.append("client_id",this.consumerKey),t.append("client_secret",this.consumerSecret),t.append("code",e),t.append("grant_type","authorization_code"),t.append("redirect_uri",this.redirectUrl),j.a.post("https://api.zenmoney.ru/oauth2/token",t).then(function(e){return e.data})}},{key:"getAuthorizationHeaders",value:function(){return{Authorization:"Bearer ".concat(this.token)}}},{key:"getDiff",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return j.a.post("https://api.zenmoney.ru/v8/diff",Object(A.a)({currentClientTimestamp:e,serverTimestamp:t},n),{headers:this.getAuthorizationHeaders()}).then(function(e){return e.data})}}]),e}())("g33fd641314bdb125b7c7ccf663323","ffd8f89676","https://1oginov.github.io/ZenMoney-Stocks/oauth"),w=function(e){return Object(k.createFetchResource)("stocks/quotes",e,function(e){return e.stockQuotes},function(t,n){S.getStockQuote(e).then(function(e){return t(e)}).catch(function(e){return n(e.toString())})},{ttl:3e5})},_={setBrokerageAccount:function(e){return function(t){t({payload:e,type:"BROKERAGE_ACCOUNT_SET"})}}},I=Object(a.b)(function(e){var t=e.brokerageAccountId,n=e.diff;return{accounts:n&&n.account?n.account.filter(function(e){return!1===e.archive&&"debt"!==e.type}):[],brokerageAccountId:t}},_)(v),D=function(e){var t=e.handleClick;return c.createElement("button",{onClick:t},"Logout")},R={logout:function(){return function(e){e({type:"LOGGED_OUT"})}}},C=Object(m.b)(Object(a.b)(null,R),Object(m.f)({handleClick:function(e){var t=e.logout;return function(){t()}}}))(D),z=function(e){var t=e.amount,n=e.logo,o=e.logoProgress,r=e.quote,u=e.quoteProgress,i=e.symbol;return c.createElement("span",null,i,(o||u)&&"Progress...",r&&c.createElement(c.Fragment,null,c.createElement("div",null,c.createElement(l,{instrumentId:1,value:r.iexRealtimePrice}),"x",t,"=",c.createElement(l,{instrumentId:1,value:t*r.iexRealtimePrice})),c.createElement("div",{style:{color:r.change>=0?"green":"red"}},c.createElement(l,{instrumentId:1,value:t*r.change}),(100*r.changePercent).toFixed(2),"%")),n&&c.createElement("img",{alt:"",src:n}))},U={fetchStockLogo:function(e){return Object(k.createFetchResource)("stocks/logos",e,function(e){return e.stockLogos},function(t,n){S.getStockLogo(e).then(function(e){return t(e)}).catch(function(e){return n(e.toString())})},{ttl:6048e5})}},Q=Object(m.b)(Object(a.b)(function(e){return{stockLogos:e.stockLogos}},U),Object(m.c)({componentDidMount:function(){var e=this.props,t=e.fetchStockLogo,n=e.symbol;n&&t(n)},componentDidUpdate:function(e){var t=this.props,n=t.fetchStockLogo,o=t.symbol;o&&o!==e.symbol&&n(o)}}),Object(m.g)(function(e){var t=e.stockLogos,n=e.symbol,o=Object(b.getResourceById)(t,n);return{logo:Object(p.extractData)(o),logoProgress:Object(p.isRequested)(o)}})),L={fetchStockQuote:w},P=Object(m.b)(Object(a.b)(function(e){return{stockQuotes:e.stockQuotes}},L),Object(m.c)({componentDidMount:function(){var e=this.props,t=e.fetchStockQuote,n=e.symbol;n&&t(n)},componentDidUpdate:function(e){var t=this.props,n=t.fetchStockQuote,o=t.symbol;o&&o!==e.symbol&&n(o)}}),Object(m.g)(function(e){var t=e.stockQuotes,n=e.symbol,o=Object(b.getResourceById)(t,n);return{quote:Object(p.extractData)(o),quoteProgress:Object(p.isRequested)(o)}})),x=Object(m.b)(Q,P)(z),N=function(e){var t=e.addAmount,n=e.addSymbol,o=e.balance,r=e.handleAddAmountChange,u=e.handleAddSymbolChange,i=e.handleSubmit,a=e.portfolio,s=e.removeStock;return c.createElement("div",null,c.createElement("form",{onSubmit:i},c.createElement("input",{onChange:u,type:"text",value:n}),c.createElement("input",{onChange:r,type:"number",value:t}),c.createElement("button",{type:"submit"},"Add")),c.createElement("div",null,"Total: ",c.createElement(l,{instrumentId:1,value:o})),c.createElement("ul",null,a.map(function(e,t){var n=e.amount,o=e.symbol;return c.createElement("li",{key:t},c.createElement(x,{amount:n,symbol:o}),c.createElement("button",{onClick:function(){return s(o)}},"Remove"))})))},K={addStock:function(e,t){return function(n){n({payload:{amount:t,symbol:e},type:"STOCK_ADDED"})}},removeStock:function(e){return function(t){t({payload:e,type:"STOCK_REMOVED"})}}},B=Object(m.b)(Object(a.b)(function(e){return{portfolio:e.portfolio,stockQuotes:e.stockQuotes}},K),Object(m.i)({addAmount:1,addSymbol:""},{handleAddAmountChange:function(){return function(e){return{addAmount:parseInt(e.target.value)>0?parseInt(e.target.value):1}}},handleAddSymbolChange:function(){return function(e){return{addSymbol:e.target.value.toUpperCase()}}}}),Object(m.f)({handleSubmit:function(e){var t=e.addAmount,n=e.addStock,o=e.addSymbol;return function(e){e.preventDefault(),n(o,t)}}}),Object(m.g)(function(e){var t=e.portfolio,n=e.stockQuotes;return{balance:h(t,n)}}))(N),F=function(){return c.createElement(c.Fragment,null,c.createElement(I,null),c.createElement(B,null),c.createElement(C,null))},M=function(e){var t=e.handleAuthorize,n=e.progress;return c.createElement("div",null,n?c.createElement("span",null,"Progress..."):c.createElement("button",{onClick:t},"Sign in"))},q={fetchTokens:function(e){return function(t){t({type:"TOKENS_REQUESTED"}),T.getTokens(e).then(function(e){t({payload:e,type:"TOKENS_RECEIVED"})})}},setAuthorizationToken:function(e){return function(t){T.setToken(e),t({type:"AUTHORIZATION_TOKEN_SET"})}}},V=Object(m.b)(Object(m.h)("progress","updateProgress",!1),Object(a.b)(function(e){return{accessToken:e.accessToken}},q),Object(m.c)({componentDidMount:function(){var e=this.props,t=e.accessToken,n=e.fetchTokens,o=e.setAuthorizationToken,r=e.updateProgress,c=T.extractAuthorizeCode(window.location);(t||c)&&(r(!0),t?o(t):n(c))},componentDidUpdate:function(e){var t=this.props,n=t.accessToken,o=t.setAuthorizationToken,r=t.updateProgress;n&&n!==e.accessToken&&(r(!0),o(n))}}),Object(m.f)({handleAuthorize:function(e){var t=e.updateProgress;return function(){t(!0),window.location=T.getAuthorizeUrl()}}}))(M),W=n(40),G=function(e){return{isAuthorized:e.isAuthorized}},H={fetchStockQuote:w},X=Object(m.b)(Object(a.b)(function(e){return{stockQuotes:e.stockQuotes}},H),Object(m.c)({componentDidMount:function(){var e=this;o=setInterval(function(){var t=e.props,n=t.fetchStockQuote,o=t.stockQuotes,r=[];o.allIds.forEach(function(e){var t=Object(b.getResourceById)(o,e);Object(p.isExpired)(t,3e5)&&(r.push(e),n(e))}),console.log("Stock quotes updater working, expired:",r)},3e4)},componentWillUnmount:function(){clearInterval(o)}})),Z={fetchDiff:function(){return function(e,t){e({type:"DIFF_REQUESTED"});var n=Math.round(Date.now()/1e3),o=t().diffServerTimestamp;T.getDiff(n,o).then(function(t){e({payload:t,type:"DIFF_RECEIVED"})})}}},J=Object(m.b)((r=V,Object(m.b)(Object(a.b)(G),Object(m.a)(function(e){return!e.isAuthorized},Object(m.e)(r)),Object(m.d)(function(e){return e.isAuthorized,Object(W.a)(e,["isAuthorized"])}))),X,Object(a.b)(function(e){return{diff:e.diff}},Z),Object(m.c)({componentDidMount:function(){(0,this.props.fetchDiff)()}}))(F),$=n(17),Y=n.n($),ee=n(8),te=n(24),ne=n.n(te),oe=n(21),re=n.n(oe),ce=n(41),ue=n(13),ie={accessToken:"",brokerageAccountId:"",diff:null,diffServerTimestamp:0,isAuthorized:!1,portfolio:[],refreshToken:"",stockLogos:Object(b.createInitialState)(),stockQuotes:Object(b.createInitialState)()},ae=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var le=document.getElementById("root"),de=function(e){var t=Object(ee.compose)(Object(te.mergePersistedState)(function(e,t){return Y.a.assign({},e,t,{isAuthorized:!1})}))(e),n=[ce.a],o=re()(window.localStorage),r=("object"===typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:ee.compose)(ee.applyMiddleware.apply(void 0,n),ne()(o,"zenmoney-stocks"));return Object(ee.createStore)(t,r)}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;if(Object(ue.isResourceAction)("stocks/logos",t))return Object(A.a)({},e,{stockLogos:Object(ue.repositoryReducer)(e.stockLogos,t)});if(Object(ue.isResourceAction)("stocks/quotes",t))return Object(A.a)({},e,{stockQuotes:Object(ue.repositoryReducer)(e.stockQuotes,t)});switch(t.type){case"AUTHORIZATION_TOKEN_SET":return Object(A.a)({},e,{isAuthorized:!0});case"BROKERAGE_ACCOUNT_SET":return Object(A.a)({},e,{brokerageAccountId:t.payload});case"DIFF_RECEIVED":return Object(A.a)({},e,{diff:Y.a.assign({},e.diff,t.payload),diffServerTimestamp:t.payload.serverTimestamp});case"LOGGED_OUT":return ie;case"STOCK_ADDED":return Object(A.a)({},e,{portfolio:e.portfolio.concat([t.payload])});case"STOCK_REMOVED":return Object(A.a)({},e,{portfolio:e.portfolio.filter(function(e){return e.symbol!==t.payload})});case"TOKENS_RECEIVED":return Object(A.a)({},e,{accessToken:t.payload.access_token,refreshToken:t.payload.refresh_token});default:return e}});i.a.render(c.createElement(a.a,{store:de},c.createElement(J,null)),le),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");ae?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):se(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):se(t,e)})}}()}},[[42,2,1]]]);
//# sourceMappingURL=main.71f651c5.chunk.js.map