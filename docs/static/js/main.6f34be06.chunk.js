(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{43:function(e,t,n){e.exports=n(78)},78:function(e,t,n){"use strict";n.r(t);var o,r,c=n(0),i=n(36),u=n.n(i),a=n(2),s=function(e){var t=e.amount,n=e.date,o=e.handleAmountChange,r=e.handleDateChange,i=e.handlePriceChange,u=e.handleSymbolChange,a=e.handleSubmit,s=e.price,l=e.symbol;return c.createElement("form",{onSubmit:a},c.createElement("input",{onChange:u,type:"text",value:l}),c.createElement("input",{min:"0",onChange:i,step:"0.01",type:"number",value:s}),c.createElement("input",{min:"1",onChange:o,type:"number",value:t}),c.createElement("input",{onChange:r,type:"date",value:n}),c.createElement("button",{type:"submit"},"Add"))},l=n(1),f=n(40),d=n.n(f),b={openPosition:function(e,t,n,o){return function(r){r({payload:{amount:n,date:o,id:d()(),price:t,symbol:e},type:"POSITION_OPENED"})}}},h=function(e){return e.toISOString().slice(0,10)},m=Object(l.b)(Object(a.b)(null,b),Object(l.i)({amount:1,date:h(new Date),price:0,symbol:""},{handleAmountChange:function(){return function(e){var t=parseInt(e.target.value);return{amount:t>0?t:1}}},handleDateChange:function(){return function(e){var t=new Date(e.target.value);return{date:h(t||new Date)}}},handlePriceChange:function(){return function(e){var t=parseFloat(e.target.value);return{price:t>=0?t:0}}},handleSymbolChange:function(){return function(e){return{symbol:e.target.value.toUpperCase()}}}}),Object(l.f)({handleSubmit:function(e){var t=e.amount,n=e.date,o=e.openPosition,r=e.price,c=e.symbol;return function(e){e.preventDefault(),o(c,r,t,n)}}}))(s),p=function(e){var t=e.amount,n=e.logo,o=e.logoProgress,r=e.quote,i=e.quoteProgress,u=e.symbol;return c.createElement("span",null,u,(o||i)&&"Progress...",r&&c.createElement(c.Fragment,null,c.createElement("div",null,r.iexRealtimePrice?r.iexRealtimePrice:r.latestPrice,"x",t,"=",t*(r.iexRealtimePrice?r.iexRealtimePrice:r.latestPrice)),c.createElement("div",{style:{color:r.change>=0?"green":"red"}},t*r.change,(100*r.changePercent).toFixed(2),"%")),n&&c.createElement("img",{alt:"",src:n}))},g=n(3),O=n(9),v=n(4),E=n(6),y=n(23),k=n(16),j=n(17),T=n(11),S=n.n(T),D=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://api.iextrading.com/1.0";Object(k.a)(this,e),this.url=t}return Object(j.a)(e,[{key:"getStockLogo",value:function(e){return S.a.get("".concat(this.url,"/stock/").concat(e,"/logo")).then(function(e){return e.data.url})}},{key:"getStockQuote",value:function(e){return S.a.get("".concat(this.url,"/stock/").concat(e,"/quote")).then(function(e){return e.data})}}]),e}()),w=function(e){return Object(y.createFetchResource)("stocks/quotes",e,function(e){return e.stocks.quotes},function(t,n){D.getStockQuote(e).then(function(e){return t(e)}).catch(function(e){return n(e.toString())})},{ttl:3e5})},A={fetchLogo:function(e){return Object(y.createFetchResource)("stocks/logos",e,function(e){return e.stocks.logos},function(t,n){D.getStockLogo(e).then(function(e){return t(e)}).catch(function(e){return n(e.toString())})},{ttl:6048e5})}},I=Object(l.b)(Object(a.b)(function(e){return{logos:e.stocks.logos}},A),Object(l.c)({componentDidMount:function(){var e=this.props,t=e.fetchLogo,n=e.symbol;n&&t(n)},componentDidUpdate:function(e){var t=this.props,n=t.fetchLogo,o=t.symbol;o&&o!==e.symbol&&n(o)}}),Object(l.d)(function(e){e.fetchLogo;var t=e.logos,n=e.symbol,o=Object(O.a)(e,["fetchLogo","logos","symbol"]),r=Object(v.getResourceById)(t,n);return Object(g.a)({logo:Object(E.extractData)(r),logoProgress:Object(E.isRequested)(r),symbol:n},o)})),_={fetchQuote:w},R=Object(l.b)(Object(a.b)(function(e){return{quotes:e.stocks.quotes}},_),Object(l.c)({componentDidMount:function(){var e=this.props,t=e.fetchQuote,n=e.symbol;n&&t(n)},componentDidUpdate:function(e){var t=this.props,n=t.fetchQuote,o=t.symbol;o&&o!==e.symbol&&n(o)}}),Object(l.d)(function(e){e.fetchQuote;var t=e.quotes,n=e.symbol,o=Object(O.a)(e,["fetchQuote","quotes","symbol"]),r=Object(v.getResourceById)(t,n);return Object(g.a)({quote:Object(E.extractData)(r),quoteProgress:Object(E.isRequested)(r),symbol:n},o)})),C=Object(l.b)(I,R)(p),P=function(e){var t=e.balance,n=e.closePosition,o=e.positions;return c.createElement("div",null,c.createElement(m,null),c.createElement("div",null,"Total: ",t),c.createElement("ul",null,o.map(function(e,t){var o=e.amount,r=e.id,i=e.symbol;return c.createElement("li",{key:t},c.createElement(C,{amount:o,symbol:i}),c.createElement("button",{onClick:function(){return n(r)}},"Remove"))})))},q=function(e,t){return e.map(function(e){var n=e.amount,o=e.symbol,r=Object(E.extractData)(Object(v.getResourceById)(t,o)),c=0;return r&&(r.iexRealtimePrice?c=r.iexRealtimePrice:r.latestPrice&&(c=r.latestPrice)),n*c}).reduce(function(e,t){return e+t},0)},z={closePosition:function(e){return function(t){t({payload:e,type:"POSITION_CLOSED"})}}},U=Object(l.b)(Object(a.b)(function(e){return{positions:e.portfolio.positions,quotes:e.stocks.quotes}},z),Object(l.g)(function(e){var t=e.positions,n=e.quotes;return{balance:q(t,n)}}))(P),F=function(e){var t=e.instrument,n=e.value;return t&&n?c.createElement("span",null,n.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),t&&t.symbol):null},L=Object(a.b)(function(e,t){var n=e.zenMoney.instruments,o=t.instrumentId;return{instrument:n.find(function(e){return e.id===o})}})(F),N=function(e){var t=e.account;return c.createElement("div",null,c.createElement("div",null,t.title),c.createElement("div",null,c.createElement(L,{instrumentId:t.instrument,value:t.balance})))},x=function(e){var t=e.balance,n=e.instrumentId;return c.createElement(L,{instrumentId:n,value:t})},M=Object(l.b)(Object(a.b)(function(e){var t=e.portfolio.positions,n=e.stocks.quotes,o=e.zenMoney;return{brokerageAccountId:o.brokerageAccountId,instruments:o.instruments,positions:t,quotes:n}}),Object(l.g)(function(e){var t=e.accounts,n=e.brokerageAccountId,o=e.instrumentId,r=e.instruments,c=e.positions,i=e.quotes,u=r.find(function(e){return e.id===o});return{balance:t.map(function(e){var t=e.balance,a=e.instrument;if(e.id===n&&(t=q(c,i),a=1),a===o)return t;var s=r.find(function(e){return e.id===a});return t/u.rate*s.rate}).reduce(function(e,t){return e+t},0)}}))(x),Q=function(e){var t=e.accounts,n=e.brokerageAccountId,o=e.setBrokerageAccount;return c.createElement("div",null,c.createElement("div",null,"Total: ",c.createElement(M,{accounts:t,instrumentId:2})),c.createElement("ul",null,t.map(function(e){return c.createElement("li",{key:e.id},e.id===n&&"*",c.createElement(N,{account:e}),c.createElement("button",{onClick:function(){return o(e.id!==n?e.id:"")}},e.id!==n?"Brokerage":"Not brokerage"))})))},K=new(function(){function e(t,n,o){Object(k.a)(this,e),this.url="https://api.zenmoney.ru",this.consumerKey=t,this.consumerSecret=n,this.redirectUrl=o}return Object(j.a)(e,[{key:"setAccessToken",value:function(e){return this.accessToken=e,this}},{key:"getAuthorizeUrl",value:function(){return"".concat(this.url,"/oauth2/authorize?client_id=").concat(this.consumerKey,"&redirect_uri=").concat(this.redirectUrl,"&response_type=code")}},{key:"extractAuthorizeCode",value:function(e){var t=new URL(e);return new URLSearchParams(t.search).get("code")}},{key:"getTokens",value:function(e){var t=new URLSearchParams;return t.append("client_id",this.consumerKey),t.append("client_secret",this.consumerSecret),t.append("code",e),t.append("grant_type","authorization_code"),t.append("redirect_uri",this.redirectUrl),S.a.post("".concat(this.url,"/oauth2/token"),t).then(function(e){return e.data})}},{key:"getAuthorizationHeader",value:function(){return{Authorization:"Bearer ".concat(this.accessToken)}}},{key:"getDiff",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return S.a.post("".concat(this.url,"/v8/diff"),Object(g.a)({currentClientTimestamp:e,serverTimestamp:t},n),{headers:Object(g.a)({},this.getAuthorizationHeader())}).then(function(e){return e.data})}}]),e}())("g33fd641314bdb125b7c7ccf663323","ffd8f89676","https://1oginov.github.io/ZenMoney-Stocks/oauth"),B={setBrokerageAccount:function(e){return function(t){t({payload:e,type:"BROKERAGE_ACCOUNT_SET"})}}},W=Object(a.b)(function(e){var t=e.zenMoney,n=t.accounts,o=t.brokerageAccountId;return{accounts:n.filter(function(e){return!1===e.archive&&"debt"!==e.type}),brokerageAccountId:o}},B)(Q),G=function(e){var t=e.handleClick;return c.createElement("button",{onClick:t},"Logout")},V={logout:function(){return function(e){e({type:"LOGGED_OUT"})}}},X=Object(l.b)(Object(a.b)(null,V),Object(l.f)({handleClick:function(e){var t=e.logout;return function(){t()}}}))(G),H=function(){return c.createElement(c.Fragment,null,c.createElement(W,null),c.createElement(X,null))},J=function(e){var t=e.handleAuthorize,n=e.progress;return c.createElement("div",null,n?c.createElement("span",null,"Progress..."):c.createElement("button",{onClick:t},"Sign in"))},$={fetchTokens:function(e){return function(t){t({type:"TOKENS_REQUESTED"}),K.getTokens(e).then(function(e){t({payload:e,type:"TOKENS_RECEIVED"})}).catch(function(e){console.error(e),t({payload:e.toString(),type:"TOKENS_FAILED"})})}},setAccessToken:function(e){return function(t){K.setAccessToken(e),t({type:"ACCESS_TOKEN_SET"})}}},Z=Object(l.b)(Object(l.h)("progress","updateProgress",!1),Object(a.b)(function(e){return{accessToken:e.zenMoney.accessToken}},$),Object(l.c)({componentDidMount:function(){var e=this.props,t=e.accessToken,n=e.fetchTokens,o=e.setAccessToken,r=e.updateProgress,c=K.extractAuthorizeCode(window.location);(t||c)&&(r(!0),t?o(t):n(c))},componentDidUpdate:function(e){var t=this.props,n=t.accessToken,o=t.setAccessToken,r=t.updateProgress;n&&n!==e.accessToken&&(r(!0),o(n))}}),Object(l.f)({handleAuthorize:function(e){var t=e.updateProgress;return function(){t(!0),window.location=K.getAuthorizeUrl()}}}))(J),Y=function(e){return{isAuthorized:e.zenMoney.isAuthorized}},ee={fetchDiff:function(){return function(e,t){e({type:"DIFF_REQUESTED"});var n=Math.round(Date.now()/1e3),o=t().zenMoney.diffServerTimestamp;K.getDiff(n,o).then(function(t){e({payload:t,type:"DIFF_RECEIVED"})}).catch(function(t){console.error(t),e({payload:t.toString(),type:"DIFF_FAILED"})})}}},te=Object(l.b)((o=Z,Object(l.b)(Object(a.b)(Y),Object(l.a)(function(e){return!e.isAuthorized},Object(l.e)(o)),Object(l.d)(function(e){return e.isAuthorized,Object(O.a)(e,["isAuthorized"])}))),Object(a.b)(null,ee),Object(l.c)({componentDidMount:function(){(0,this.props.fetchDiff)()}}))(H),ne=function(){return c.createElement(c.Fragment,null,c.createElement(te,null),c.createElement(U,null))},oe={fetchQuote:w},re=Object(l.b)(Object(a.b)(function(e){return{quotes:e.stocks.quotes}},oe),Object(l.c)({componentDidMount:function(){var e=this;r=setInterval(function(){var t=e.props,n=t.fetchQuote,o=t.quotes,r=[];o.allIds.forEach(function(e){var t=Object(v.getResourceById)(o,e);Object(E.isExpired)(t,3e5)&&(r.push(e),n(e))}),console.log("Stock quotes updater working, expired:",r)},3e4)},componentWillUnmount:function(){clearInterval(r)}}),Object(l.d)(function(e){e.fetchQuote,e.quotes;return Object(O.a)(e,["fetchQuote","quotes"])}))(ne),ce=n(8),ie=n(24),ue=n.n(ie),ae=n(21),se=n.n(ae),le=n(41),fe={positions:[]},de=n(14),be={logos:Object(v.createInitialState)(),quotes:Object(v.createInitialState)()},he=function(e,t){if(!e&&!t)return[];if(!e)return t;var n=e.slice();return t?(t.forEach(function(e){var t=n.findIndex(function(t){return t.id===e.id});-1===t?n.push(e):n[t]=e}),n):n},me={brokerageAccountId:"",accessToken:"",areTokensRequested:!1,isAuthorized:!1,refreshToken:"",tokensError:"",accounts:[],diffError:"",diffServerTimestamp:0,instruments:[],isDiffRequested:!1},pe=Object(ce.combineReducers)({portfolio:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe,t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case"POSITION_CLOSED":return Object(g.a)({},e,{positions:e.positions.slice().filter(function(e){return e.id!==n})});case"POSITION_OPENED":return Object(g.a)({},e,{positions:e.positions.slice().concat([n])});default:return e}},stocks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0;return Object(de.isResourceAction)("stocks/logos",t)?Object(g.a)({},e,{logos:Object(de.repositoryReducer)(e.logos,t)}):Object(de.isResourceAction)("stocks/quotes",t)?Object(g.a)({},e,{quotes:Object(de.repositoryReducer)(e.quotes,t)}):e},zenMoney:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case"BROKERAGE_ACCOUNT_SET":return Object(g.a)({},e,{brokerageAccountId:n});case"ACCESS_TOKEN_SET":return Object(g.a)({},e,{isAuthorized:!0});case"TOKENS_FAILED":return Object(g.a)({},e,{accessToken:"",areTokensRequested:!1,isAuthorized:!1,refreshToken:"",tokensError:n});case"TOKENS_RECEIVED":return Object(g.a)({},e,{accessToken:n.access_token,areTokensRequested:!1,refreshToken:n.refresh_token,tokensError:""});case"TOKENS_REQUESTED":return Object(g.a)({},e,{areTokensRequested:!0});case"LOGGED_OUT":return me;case"DIFF_FAILED":return Object(g.a)({},e,{diffError:n,isDiffRequested:!1});case"DIFF_RECEIVED":return Object(g.a)({},e,{accounts:he(e.accounts,n.account),diffError:"",diffServerTimestamp:n.serverTimestamp,instruments:he(e.instruments,n.instrument),isDiffRequested:!1});case"DIFF_REQUESTED":return Object(g.a)({},e,{isDiffRequested:!0});default:return e}}}),ge=n(42),Oe=n.n(ge),ve=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ee(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ye=document.getElementById("root"),ke=function(e,t){var n=Object(ce.compose)(Object(ie.mergePersistedState)(t))(e),o=[le.a],r=se()(window.localStorage),c=("object"===typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:ce.compose)(ce.applyMiddleware.apply(void 0,o),ue()(r,"zenmoney-stocks"));return Object(ce.createStore)(n,c)}(pe,function(e,t){return Oe.a.merge({},e,t,{zenMoney:{isAuthorized:!1}})});u.a.render(c.createElement(a.a,{store:ke},c.createElement(re,null)),ye),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");ve?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Ee(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Ee(t,e)})}}()}},[[43,2,1]]]);
//# sourceMappingURL=main.6f34be06.chunk.js.map